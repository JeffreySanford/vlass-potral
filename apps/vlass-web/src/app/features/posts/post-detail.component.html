<div class="detail-page">
  <mat-toolbar color="primary" class="detail-toolbar">
    <span>Notebook Post</span>
    <span class="spacer"></span>
    <a mat-flat-button routerLink="/posts">Back to feed</a>
  </mat-toolbar>

  <section class="detail-shell">
    @if (loading) {
      <p>Loading post...</p>
    } @else if (!post) {
      <p>{{ statusMessage || 'Post unavailable.' }}</p>
    } @else {
      <mat-card class="detail-card">
        <mat-card-header>
          <mat-card-title>{{ post.title }}</mat-card-title>
          <mat-card-subtitle>
            {{ post.user?.display_name || post.user?.username || 'Unknown author' }} | {{ post.status }}
            @if (post.hidden_at) {
              | hidden
            }
            @if (post.locked_at) {
              | locked
            }
          </mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <section class="share-panel">
            <span class="share-url">{{ post.id }}</span>
            <button mat-stroked-button type="button" (click)="copyShareLink()">Copy Share Link</button>
          </section>

          <section class="view-toggle">
            <button mat-stroked-button type="button" [disabled]="viewMode === 'formatted'" (click)="viewMode = 'formatted'">
              Formatted View
            </button>
            <button mat-stroked-button type="button" [disabled]="viewMode === 'raw'" (click)="viewMode = 'raw'">
              Raw Markdown
            </button>
          </section>

          @if (viewMode === 'raw') {
            <pre class="content">{{ post.content }}</pre>
          } @else {
            <div class="content formatted" [innerHTML]="formattedContent"></div>
          }
        </mat-card-content>
        <mat-card-actions>
          @if (post.status === 'draft') {
            <button mat-stroked-button type="button" [disabled]="publishing" (click)="publish()">
              @if (publishing) {
                Publishing...
              } @else {
                Publish
              }
            </button>
          }
          @if (canModerate) {
            <button mat-stroked-button type="button" [disabled]="moderating" (click)="toggleHidden()">
              {{ post.hidden_at ? 'Unhide' : 'Hide' }}
            </button>
            <button mat-stroked-button type="button" [disabled]="moderating" (click)="toggleLocked()">
              {{ post.locked_at ? 'Unlock' : 'Lock' }}
            </button>
          }
          <a mat-button routerLink="/view">Open Viewer</a>
        </mat-card-actions>
      </mat-card>
    }

    @if (statusMessage) {
      <p class="status">{{ statusMessage }}</p>
    }
  </section>
</div>
