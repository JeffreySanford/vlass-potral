<div class="gdpr-dialog-container">
  <div class="dialog-header">
    <h2>Location Permission (GDPR)</h2>
    <p class="subtitle">
      We would like to gather your location data to personalize your sky preview.
    </p>
  </div>

  <div class="dialog-content">
    <div class="privacy-notice">
      <mat-icon>privacy_tip</mat-icon>
      <p>
        Your location data will be used only to display a customized sky preview
        for your region. This data will not be stored or shared with third parties.
      </p>
    </div>

    <div class="consent-checkbox">
      <mat-checkbox
        [(ngModel)]="userConsent"
        (change)="userConsent ? null : (userConsent = false)"
      >
        I consent to share my location data for personalization
      </mat-checkbox>
    </div>

    @if (userConsent && (locationData.latitude === null || locationData.longitude === null)) {
      <button mat-raised-button color="primary" (click)="requestLocation()" class="location-btn">
        <mat-icon>location_on</mat-icon>
        Detect My Location
      </button>
    }

    @if (locationData.latitude !== null && locationData.longitude !== null) {
      <div class="location-display">
        <p>
          <strong>Latitude:</strong>
          {{ locationData.latitude | number : '1.4-4' }}
        </p>
        <p>
          <strong>Longitude:</strong>
          {{ locationData.longitude | number : '1.4-4' }}
        </p>
      </div>
    }

    @if (geolocationError) {
      <p class="location-error">{{ geolocationError }}</p>
    }
  </div>

  <div class="dialog-actions">
    <button mat-button (click)="deny()">Deny</button>
    <button
      mat-raised-button
      color="primary"
      (click)="confirmLocation()"
      [disabled]="!userConsent || locationData.latitude === null || locationData.longitude === null"
    >
      Continue
    </button>
  </div>
</div>
